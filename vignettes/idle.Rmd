---
title: "Idle Callback"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Idle Callback}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


## Run a function continually while window is valid

An **idle callback** is a function that will be run continually while the 
UI window is valid.

This callback function is just an R function which takes no arguments.

Idle callbacks can only be set on the toplevel `tic_window()` element.




# Video 

Since an interactive window cannot be captured in a vignette, a video
screen capture has been taken of the window and included below.

<video controls>
  <source src="video/idle.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video> 




## Code

* Open a normal R device
* Write the idle function to draw a line between two random points
* Create a simple GUI that lets the user select line colour and linetype
* The idle callback will be called continually - using the latest values
  selected by the user

```{r eval = FALSE}
library(grid)
library(tickle)

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Open a double-buffered graphics device that renders nice and fast
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
x11(type = 'dbcairo', antialias = 'none')
dev.control(displaylist = 'inhibit')


#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# REactive variables controlled by the UI
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
cols <- rainbow(6)
col_choice <- reactive_chr(cols[1])

thickness <- reactive_dbl(1)


#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Function to draw random lines.  Uses global reactive variables to influence
# the line appearance
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
so_random <- function() {
  x1 <- runif(1)
  y1 <- runif(1)
  x2 <- runif(1)
  y2 <- runif(1)
  
  dev.hold()
  grid::grid.lines(
    x = c(x1, x2),
    y = c(y1, y2),
    gp = gpar(col = col_choice(), lwd = thickness())
  )
  dev.flush()
}


#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Define the UI.  Top-level window has an 'idle_func'
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
ui_spec <- tic_window(
  idle_func = so_random, idle_fps = 10,
  tic_col(
    tic_label("I'm so random!!", style = 'h3'),
    tic_separator(),
    tic_row(
      tic_label("Thickness"),
      tic_slider(variable = thickness, from = 1, to = 10)
    ),
    tic_row(
      tic_label("Colour"),
      tic_spinbox(values = cols, textvariable = col_choice)
    )
  )
)


#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Render the UI
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
win <- render_ui(ui_spec)
```


